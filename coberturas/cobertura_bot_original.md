const main = async () => {
    try {
        const normalizeString = (str) =>
            str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();

        const direccion = user.get('direccion');
        const direccionNormalizada = normalizeString(direccion);
        bmconsole.log(`DirecciÃ³n ingresada: ${direccionNormalizada}`);

        const zonasDeCobertura = [{ calle: 'paz', desde: 1, hasta: 1599 },
  { calle: 'general paz', desde: 1, hasta: 1599 },
  { calle: 'gral paz', desde: 1, hasta: 1599 },
  { calle: 'gral. paz', desde: 1, hasta: 1599 },
  { calle: '4 de abril', desde: 1, hasta: 1600 },
  { calle: '4 abril', desde: 1, hasta: 1600 },
  { calle: 'cuatro de abril', desde: 1, hasta: 1600 },
  { calle: 'santamarina', desde: 1, hasta: 900 },
  { calle: 'av Santamarina', desde: 1, hasta: 900 },
  { calle: 'av Santa marina', desde: 1, hasta: 900 },
  { calle: 'av. Santamarina', desde: 1, hasta: 900 },
  { calle: 'av. Santa marina', desde: 1, hasta: 900 },
  { calle: 'avenida Santa marina', desde: 1, hasta: 900 },
  { calle: 'avenida Santamarina', desde: 1, hasta: 900 },
  { calle: 'alsina', desde: 1, hasta: 1600 },
  { calle: 'alcina', desde: 1, hasta: 1600 },
  { calle: 'gral roca', desde: 1, hasta: 1600 },
  { calle: 'gral. roca', desde: 1, hasta: 1600 },
  { calle: 'general roca', desde: 1, hasta: 1600 },
  { calle: 'roca', desde: 1, hasta: 1600 },
  { calle: '11 de septiembre', desde: 1, hasta: 1600 },
  { calle: '11 de setiembre', desde: 1, hasta: 1600 },
  { calle: 'once de setiembre', desde: 1, hasta: 1600 },
  { calle: 'once de septiembre', desde: 1, hasta: 1600 },
  { calle: 'montiel', desde: 1, hasta: 1600 },
  { calle: 'moreno', desde: 1, hasta: 1600 },
  { calle: 'saavedra', desde: 1, hasta: 1600 },
  { calle: 'savedra', desde: 1, hasta: 1600 },
  { calle: 'saaveedra', desde: 1, hasta: 1600 },
  { calle: 'saaveedra', desde: 1, hasta: 1600 },
  { calle: 'buzon', desde: 1, hasta: 1100 },
  { calle: 'av buzon', desde: 1, hasta: 1100 },
  { calle: 'av buzÃ³n', desde: 1, hasta: 1100 },
  { calle: 'avenida buzon', desde: 1, hasta: 1100 },
  { calle: 'avenida marconi', desde: 1000, hasta: 1800 },
  { calle: 'av marconi', desde: 1000, hasta: 1800 },
  { calle: 'marconi', desde: 1000, hasta: 1800 },
  { calle: 'avenida espaÃ±a', desde: 900, hasta: 1000 },
  { calle: 'av espaÃ±a', desde: 900, hasta: 1000 },
  { calle: 'av. espaÃ±a', desde: 900, hasta: 1000 },
  { calle: 'espaÃ±a', desde: 900, hasta: 1000 },
  { calle: 'sarmiento', desde: 900, hasta: 1800 },
  { calle: 'mitre', desde: 900, hasta: 1800 },
  { calle: 'sanmartin', desde: 900, hasta: 1800 },
  { calle: 'san martin', desde: 900, hasta: 1800 },
  { calle: 'san martÃ­n', desde: 900, hasta: 1800 },
  { calle: 'pinto', desde: 900, hasta: 1800 },
  { calle: 'belgrano', desde: 900, hasta: 1800 },
  { calle: 'gral. belgrano', desde: 900, hasta: 1800 },
  { calle: 'gral belgrano', desde: 900, hasta: 1800 },
  { calle: 'general belgrano', desde: 900, hasta: 1800 },
  { calle: 'maipu', desde: 900, hasta: 1800 },
  { calle: 'maipÃº', desde: 900, hasta: 1800 },
  { calle: 'veinticinco de mayo', desde: 900, hasta: 1800 },
  { calle: '25demayo', desde: 900, hasta: 1800 },
  { calle: '25 de mayo', desde: 900, hasta: 1800 },
  { calle: 'constitucion', desde: 900, hasta: 1800 },
  { calle: 'constituciÃ³n', desde: 900, hasta: 1800 },
  { calle: 'avellaneda', desde: 900, hasta: 1800 },
  { calle: 'avenida avellaneda', desde: 900, hasta: 1800 },
  { calle: 'av avellaneda', desde: 900, hasta: 1800 },
  { calle: 'av. avellaneda', desde: 900, hasta: 1800 },
  { calle: '1 de mayo', desde: 1000, hasta: 1499 },
  { calle: 'uno de mayo', desde: 1000, hasta: 1499 },
  { calle: 'primero de mayo', desde: 1000, hasta: 1499 },
  { calle: '1ero de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pasaje primero de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pasaje 1 de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pasaje uno de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pasaje 1ero de mayo', desde: 1000, hasta: 1499 },
  { calle: 'psje 1ero de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pje 1ero de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pje. 1ero de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pasaje uno de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pje 1 de mayo', desde: 1000, hasta: 1499 },
  { calle: 'psaje 1 de mayo', desde: 1000, hasta: 1499 },
  { calle: 'pje uno de mayo', desde: 1000, hasta: 1499 },
  { calle: 'psaje uno de mayo', desde: 1000, hasta: 1499 },
  { calle: 'roser', desde: 1500, hasta: 1599 },
  { calle: 'rosser', desde: 1500, hasta: 1599 },
  { calle: 'cruz roja argentina', desde: 0, hasta: 1700 },
  { calle: 'cruz roja', desde: 0, hasta: 1700 },
  { calle: 'cruz roja arg.', desde: 0, hasta: 1700 },
  { calle: 'cruz roja arg', desde: 0, hasta: 1700 },
  { calle: 'pasaje cruz roja argentina', desde: 0, hasta: 1700 },
  { calle: 'pje cruz roja argentina', desde: 0, hasta: 1700 },
  { calle: 'pje. cruz roja argentina', desde: 0, hasta: 1700 },
  { calle: 'cruz roja argentina casa', desde: 0, hasta: 1700 },
  { calle: 'cruz roja casa', desde: 0, hasta: 1700 },
  { calle: 'cruz roja arg. casa', desde: 0, hasta: 1700 },
  { calle: 'cruz roja arg casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje cruz roja argentina casa', desde: 0, hasta: 1700 },
  { calle: 'pje cruz roja argentina casa', desde: 0, hasta: 1700 },
  { calle: 'pje. duggan martignoni casa', desde: 0, hasta: 1700 },
  { calle: 'duggan martignoni', desde: 0, hasta: 1700 },
  { calle: 'dugan martinoni', desde: 0, hasta: 1700 },
  { calle: 'dugan martignoni', desde: 0, hasta: 1700 },
  { calle: 'pje. duggan martignoni ', desde: 0, hasta: 1700 },
  { calle: 'duggan martignoni casa', desde: 0, hasta: 1700 },
  { calle: 'dugan martinoni casa', desde: 0, hasta: 1700 },
  { calle: 'dugan martignoni casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje agote casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje agote', desde: 0, hasta: 1700 },
  { calle: 'pje. agote casa', desde: 0, hasta: 1700 },
  { calle: 'pje. agote', desde: 0, hasta: 1700 },
  { calle: 'pasaje luis agote casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje luis agote', desde: 0, hasta: 1700 },
  { calle: 'pje. luis agote casa', desde: 0, hasta: 1700 },
  { calle: 'pje. luis agote', desde: 0, hasta: 1700 },
  { calle: 'pje. r. gutierrez casa', desde: 0, hasta: 1700 },
  { calle: 'r. gutierrez', desde: 0, hasta: 1700 },
  { calle: 'r gutierrez', desde: 0, hasta: 1700 },
  { calle: 'r. gutierrez casa', desde: 0, hasta: 1700 },
  { calle: 'pje. r. gutierrez', desde: 0, hasta: 1700 },
  { calle: 'r. gutierrez casa', desde: 0, hasta: 1700 },
  { calle: 'r gutierrez casa', desde: 0, hasta: 1700 },
  { calle: 'pje. r gutierrez casa', desde: 0, hasta: 1700 },
  { calle: 'pje. mariano castex casa', desde: 0, hasta: 1700 },
  { calle: 'pje. mariano castex ', desde: 0, hasta: 1700 },
  { calle: 'mariano castex', desde: 0, hasta: 1700 },
  { calle: 'mariano castex casa', desde: 0, hasta: 1700 },
  { calle: 'pje mariano castex', desde: 0, hasta: 1700 },
  { calle: 'pje mariano castex casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje mariano castex casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje mariano castex ', desde: 0, hasta: 1700 },
  { calle: 'pje. baldomero moreno casa', desde: 0, hasta: 1700 },
  { calle: 'pje. baldomero moreno', desde: 0, hasta: 1700 },
  { calle: 'baldomero moreno', desde: 0, hasta: 1700 },
  { calle: 'baldomero moreno casa', desde: 0, hasta: 1700 },
  { calle: 'pje baldomero moreno', desde: 0, hasta: 1700 },
  { calle: 'pje baldomero moreno casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje baldomero moreno casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje baldomero moreno ', desde: 0, hasta: 1700 },
  { calle: 'pje. crucero gral belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pje. crucero gral belgrano', desde: 0, hasta: 1700 },
  { calle: 'crucero gral belgrano', desde: 0, hasta: 1700 },
  { calle: 'crucero gral belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pje crucero gral belgrano', desde: 0, hasta: 1700 },
  { calle: 'pje crucero gral belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje crucero gral belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje crucero gral belgrano ', desde: 0, hasta: 1700 },
  { calle: 'pje. crucero general belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pje. crucero general belgrano', desde: 0, hasta: 1700 },
  { calle: 'crucero general belgrano', desde: 0, hasta: 1700 },
  { calle: 'crucero general belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pje crucero general belgrano', desde: 0, hasta: 1700 },
  { calle: 'pje crucero general belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje crucero general belgrano casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje crucero general belgrano ', desde: 0, hasta: 1700 },
  { calle: 'pje. combate de obligado casa', desde: 0, hasta: 1700 },
  { calle: 'pje. combate de obligado', desde: 0, hasta: 1700 },
  { calle: 'combate de obligado', desde: 0, hasta: 1700 },
  { calle: 'combate de obligado casa', desde: 0, hasta: 1700 },
  { calle: 'pje combate de obligado', desde: 0, hasta: 1700 },
  { calle: 'pje combate de obligado casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje combate de obligado casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje combate de obligado', desde: 0, hasta: 1700 },
  { calle: 'pje. combate de obligado casa', desde: 0, hasta: 1700 },
  { calle: 'pje. Combatientes de malvinas', desde: 0, hasta: 1700 },
  { calle: ' Combatientes de malvinas ', desde: 0, hasta: 1700 },
  { calle: ' Combatientes de malvinas casa', desde: 0, hasta: 1700 },
  { calle: 'pje Combatientes de malvinas ', desde: 0, hasta: 1700 },
  { calle: 'pje Combatientes de malvinas casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje Combatientes de malvinas casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje Combatientes de malvinas ', desde: 0, hasta: 1700 },
  { calle: 'pje. S. Austral', desde: 0, hasta: 1700 },
  { calle: ' S. Austral ', desde: 0, hasta: 1700 },
  { calle: ' S. Austral casa', desde: 0, hasta: 1700 },
  { calle: 'pje SoberanÃ­a Austral ', desde: 0, hasta: 1700 },
  { calle: 'pje SoberanÃ­a Austral casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje SoberanÃ­a Austral casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje SoberanÃ­a Austral ', desde: 0, hasta: 1700 },
  { calle: 'pje. puerto argentino casa', desde: 0, hasta: 1700 },
  { calle: 'pje. puerto argentino', desde: 0, hasta: 1700 },
  { calle: 'puerto argentino', desde: 0, hasta: 1700 },
  { calle: 'puerto argentino casa', desde: 0, hasta: 1700 },
  { calle: 'pje puerto argentino', desde: 0, hasta: 1700 },
  { calle: 'pje puerto argentino casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje puerto argentino casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje puerto argentino', desde: 0, hasta: 1700 },
  { calle: 'pje. jose vernet casa', desde: 0, hasta: 1700 },
  { calle: 'pje. jose vernet', desde: 0, hasta: 1700 },
  { calle: 'jose vernet', desde: 0, hasta: 1700 },
  { calle: 'jose vernet casa', desde: 0, hasta: 1700 },
  { calle: 'pje jose vernet', desde: 0, hasta: 1700 },
  { calle: 'pje jose vernet casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje jose vernet casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje jose vernet', desde: 0, hasta: 1700 },
  { calle: 'pje. c. posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'pje. c. posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'c. posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'c. posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'pje c. posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'pje c. posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje c. posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'pasaje c. posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'pje. c. posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'pje. posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'posta de yatasto casa', desde: 0, hasta: 1700 },
  { calle: 'posta de yatasto', desde: 0, hasta: 1700 },
  { calle: 'av. machado', desde: 900, hasta: 1800 },
  { calle: 'avenida machado', desde: 900, hasta: 1800 },
  { calle: 'machado', desde: 900, hasta: 1800 },
  { calle: 'arana', desde: 900, hasta: 1800 },
  { calle: 'uriburu', desde: 900, hasta: 1800 },
  { calle: 'pellegrini', desde: 900, hasta: 1800 },
  { calle: 'montevideo', desde: 900, hasta: 1800 },
  { calle: 'las heras', desde: 900, hasta: 1800 },
  { calle: 'garibaldi', desde: 900, hasta: 1800 },
  { calle: 'av balbin', desde: 900, hasta: 1700 },
  { calle: 'balbin', desde: 900, hasta: 1700 },
  { calle: 'avenida balbin', desde: 900, hasta: 1700 },
  { calle: 'avenida colÃ³n', desde: 900, hasta: 1600 },
  { calle: 'av colÃ³n', desde: 900, hasta: 1600 },
  { calle: 'colÃ³n', desde: 900, hasta: 1600 },
  { calle: 'avenida colon', desde: 900, hasta: 1600 },
  { calle: 'av colon', desde: 900, hasta: 1600 },
  { calle: 'colon', desde: 900, hasta: 1600 },
  { calle: 'av espora', desde: 800, hasta: 1400 },
  { calle: 'espora', desde: 800, hasta: 1400 },
  { calle: 'avenida espora', desde: 800, hasta: 1400 },
  { calle: 'guatemala', desde: 900, hasta: 1500 },
  { calle: 'mejico', desde: 1000, hasta: 1400 },
  { calle: 'mexico', desde: 1000, hasta: 1400 },
  { calle: 'gomez', desde: 1200, hasta: 1400 },
  { calle: 'colectora sur', desde: 1000, hasta: 1800 },
  { calle: 'colectora sur j.c pugliese', desde: 1000, hasta: 1800 },
  { calle: 'colectora j.c pugliese', desde: 1000, hasta: 1800 },
  { calle: 'colectora pugliese', desde: 1000, hasta: 1800 },
  { calle: 'pugliese', desde: 1000, hasta: 1800 },
  { calle: 'piedrabuena', desde: 1000, hasta: 1800 },
  { calle: 'piÃ±ero', desde: 1200, hasta: 1600 },
  { calle: 'piÃ±iero', desde: 1200, hasta: 1600 },
  { calle: 'piÃ±eiro', desde: 1200, hasta: 1600 },
  { calle: 'primera junta', desde: 1000, hasta: 1800 },
  { calle: 'franklin', desde: 1000, hasta: 1700 },
  { calle: 'colombia', desde: 1000, hasta: 1400 },
  { calle: 'newton', desde: 900, hasta: 1400 },
  { calle: 'edison', desde: 900, hasta: 1200 },
  { calle: 'cuba', desde: 900, hasta: 1400 },
  { calle: 'haiti', desde: 900, hasta: 1400 },
  { calle: 'jurado', desde: 1200, hasta: 1400 },
  { calle: 'rauch', desde: 1000, hasta: 1400 },
  { calle: 'peyrel', desde: 1200, hasta: 1400 },
  { calle: 'honduras', desde: 1300, hasta: 1400 },
  { calle: 'pioxii', desde: 1300, hasta: 1400 },
  { calle: 'pioXII', desde: 1300, hasta: 1400 },
  { calle: 'guemes', desde: 1200, hasta: 1400 },
  { calle: 'gÃ¼emes', desde: 1200, hasta: 1400 },
  { calle: 'pasaje guernica', desde: 1600, hasta: 1800 },
  { calle: 'pje guernica', desde: 1600, hasta: 1800 },
  { calle: 'pje guernica', desde: 1600, hasta: 1800 },
  { calle: 'pasaje orbe', desde: 0, hasta: 1800 },
  { calle: 'pje orbe', desde: 0, hasta: 1800 },
  { calle: 'orbe', desde: 0, hasta: 1800 },
  { calle: 'pasaje c. disney', desde: 0, hasta: 1800 },
  { calle: 'pje c. disney', desde: 0, hasta: 1800 },
  { calle: 'c. disney', desde: 0, hasta: 1800 },
  { calle: 'Pasaje interno barrio san francisco', desde: 1100, hasta: 1500 },
  { calle: 'pje interno barrio san francisco', desde: 1100, hasta: 1500 },
  { calle: 'Pasaje interno bo san francisco', desde: 1100, hasta: 1500 },
  { calle: 'liniers', desde: 1000, hasta: 1700 },
  { calle: 'pje castelli', desde: 1100, hasta: 1800 },
  { calle: 'Pasaje castelli', desde: 1100, hasta: 1800 },
  { calle: 'Castelli', desde: 1100, hasta: 1800 }];

        // Buscar nÃºmero en la direcciÃ³n (primera secuencia numÃ©rica)
        const numeroEncontrado = parseInt(direccionNormalizada.match(/\d+/)?.[0] || '', 10);
        if (isNaN(numeroEncontrado)) {
            bm.sendTextMessage(user.id, 'No pude encontrar un nÃºmero en tu direcciÃ³n. Â¿PodÃ©s escribirla con calle y nÃºmero?');
            user.set('dentroDeCobertura', false);
            return result.done();
        }

        // Extraer texto antes del nÃºmero como calle
        const calleExtraida = direccionNormalizada.split(String(numeroEncontrado))[0].trim();

        const dentroDeCobertura = zonasDeCobertura.some(zona => {
            const calleZona = normalizeString(zona.calle);
            const coincideCalle = direccionNormalizada.includes(calleZona);
            const coincideNumero = numeroEncontrado >= zona.desde && numeroEncontrado <= zona.hasta;
            return coincideCalle && coincideNumero;
        });

        user.set('dentroDeCobertura', dentroDeCobertura);
        bmconsole.log(`Calle detectada: ${calleExtraida}, NÃºmero: ${numeroEncontrado}, Cobertura: ${dentroDeCobertura}`);

        if (dentroDeCobertura) {
            bm.sendTextMessage(user.id, 'âœ… Â¡Genial! Tu direcciÃ³n estÃ¡ dentro de nuestra zona de cobertura.');
        } else {
            bm.sendTextMessage(user.id, 'ðŸš« Lo sentimos, tu direcciÃ³n no figura dentro de nuestra zona de cobertura.');
        }

    } catch (err) {
        const errorMessage = `[Cobertura] Error: ${err.message}`;
        user.set('ca_error', errorMessage);
        bmconsole.log(errorMessage);
    } finally {
        result.done();
    }
};

main();
